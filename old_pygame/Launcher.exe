#!/usr/bin/env python
import os, sys
import json

from PyQt5.QtWidgets import QApplication
from PyQt5.QtCore import Qt, QCoreApplication

from _lib.gui import GUI
from _lib.commons import *
from engine import game_main

# Layouts
# key: (val-small, val-medium, val-large)
LAYOUT_SMALL = 0
LAYOUT_MEDIUM = 1
LAYOUT_LARGE = 2

LAUNCHER_LAYOUT = {
    # Window size: (w, h)
    "window": [ 
        (400, 300), 
        (800, 600),
        (1200, 900)
    ],
    # Game start button: (w, h, x, y)
    "btn_gamestart": [
        (280, 40, 10, 250, 30),
        (460, 50, 50, 510, 36),
        (740, 100, 60, 750, 48)
    ],
    # Setting button: (w, h, x, y, font-size)
    "btn_setting": [
        (90, 40, 300, 250, 22),
        (200, 50, 540, 510, 28),
        (300, 100, 840, 750, 40)
    ],
}

# Stylesheets
SS_BUTTON_DEFAULT = """
QPushButton { 
    background-color: #202020; 
    border: none; 
    border-radius: 5px; 
    font-size: 36px; 
    color: #dddddd; 
} 
QPushButton:hover { 
    background-color: #303030; 
}"""

SS_BUTTON_CTRL_DEFAULT = """
QPushButton { 
    border: none; 
    font: bold; 
    font-size: 15px; 
} 
QPushButton:hover { 
    background-color: #303030; 
}"""

SS_BUTTON_CTRL_DISABLED = """
QPushButton { 
    border: none; 
    font: bold; 
    font-size: 15px; 
    color: gray; 
}"""

SS_FONTSIZE = ["QPushButton { font-size: %dpx; }" % i for i in range(100) ]



def launcher():
    ret = -1

    layout = int(1)

    app = QApplication([])

    launcher_cfg = {
        "title": "Game Launcher",
        "w": LAUNCHER_LAYOUT["window"][layout][0],
        "h": LAUNCHER_LAYOUT["window"][layout][1],
        "winflags": Qt.Window
        #"winflags": Qt.FramelessWindowHint,
    }

    game_input = {
        "resolution": [1024, 768],
    }

    launcher_main = GUI(**launcher_cfg)
    """
    launcher_main.add_button(
        name="ðŸ—•",
        w=40, h=30, x=LAUNCHER_LAYOUT["window"][layout][0]-120, y=0, 
        func_cb=launcher_main.showMinimized, 
        stylesheet=SS_BUTTON_CTRL_DEFAULT
    )

    launcher_main.add_button(
        name="ðŸ—–ï¸Ž",
        w=40, h=30, x=LAUNCHER_LAYOUT["window"][layout][0]-80, y=0, 
        stylesheet=SS_BUTTON_CTRL_DISABLED
    )

    launcher_main.add_button(
        name="ðŸ—™ï¸Ž", 
        w=40, h=30, x=LAUNCHER_LAYOUT["window"][layout][0]-40, y=0, 
        func_cb=launcher_main.close,
        stylesheet=SS_BUTTON_CTRL_DEFAULT
    )
    """

    launcher_main.add_button(
        name="Game Start",
        **{list(["w", "h", "x", "y"])[i]: LAUNCHER_LAYOUT["btn_gamestart"][layout][i] for i in range(4)},
        func_cb=lambda: game_main(**game_input),
        stylesheet=SS_BUTTON_DEFAULT + SS_FONTSIZE[LAUNCHER_LAYOUT["btn_gamestart"][layout][4]]
    )

    launcher_main.add_button(
        name="Setting", 
        **{list(["w", "h", "x", "y"])[i]: LAUNCHER_LAYOUT["btn_setting"][layout][i] for i in range(4)},
        func_cb=launcher_main.close,
        stylesheet=SS_BUTTON_DEFAULT + SS_FONTSIZE[LAUNCHER_LAYOUT["btn_setting"][layout][4]]
    )

    launcher_main.ready()
    app.exec_()

if __name__ == "__main__":
    launcher()
